- name: yum
  vars:
    # yum-python bindings are not python3 compatible
    ansible_python_interpreter: /usr/bin/python2
  yum:
    name:
    - unzip
    - iproute
    - vim
    - make
    - git
    - gcc-c++
    - redhat-lsb-core
    state: present
- name: download consul
  get_url:
    url: https://releases.hashicorp.com/consul/1.9.3/consul_1.9.3_linux_amd64.zip
    dest: /tmp/consul.zip
  register: consul_zip

- name: install consul
  unarchive:
    src: /tmp/consul.zip
    dest: /usr/bin
    copy: no
  when: consul_zip.changed

- name: install daq-buildtools
  git:
    repo: https://github.com/DUNE-DAQ/daq-buildtools.git
    dest: /opt/dune/daq-buildtools
    version: dunedaq-v2.2.0

- name: download nomad
  get_url:
    url: https://releases.hashicorp.com/nomad/1.0.3/nomad_1.0.3_linux_amd64.zip
    dest: /tmp/nomad.zip
  register: nomad_zip

- name: install nomad
  unarchive:
    src: /tmp/nomad.zip
    dest: /usr/bin
    copy: no
  when: nomad_zip.changed
- name: make nomad config directory
  file:
    path: /etc/nomad.d
    state: directory
